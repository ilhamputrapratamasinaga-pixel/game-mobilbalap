<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Racing Shooter ‚Äì Full Control</title>
<style>
body{
    margin:0;
    background:#111;
    color:white;
    text-align:center;
    font-family:Arial;
}
canvas{
    display:block;
    margin:auto;
    background:#333;
}
</style>
</head>
<body>

<h3>üöó Racing Shooter (WASD + Arrow)</h3>
<p>WASD / ‚¨ÖÔ∏è‚û°Ô∏è‚¨ÜÔ∏è‚¨áÔ∏è Move | SPACE Shoot | R Reset</p>

<canvas id="game" width="360" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ===== INPUT ===== */
const keys = { left:false, right:false, up:false, down:false };

document.addEventListener("keydown", e=>{
    if(e.key==="a"||e.key==="A"||e.key==="ArrowLeft") keys.left=true;
    if(e.key==="d"||e.key==="D"||e.key==="ArrowRight") keys.right=true;
    if(e.key==="w"||e.key==="W"||e.key==="ArrowUp") keys.up=true;
    if(e.key==="s"||e.key==="S"||e.key==="ArrowDown") keys.down=true;
    if(e.code==="Space") shoot();
    if(e.key==="r"||e.key==="R") resetGame();
});

document.addEventListener("keyup", e=>{
    if(e.key==="a"||e.key==="A"||e.key==="ArrowLeft") keys.left=false;
    if(e.key==="d"||e.key==="D"||e.key==="ArrowRight") keys.right=false;
    if(e.key==="w"||e.key==="W"||e.key==="ArrowUp") keys.up=false;
    if(e.key==="s"||e.key==="S"||e.key==="ArrowDown") keys.down=false;
});

/* ===== UTIL ===== */
function randColor(){
    const c=["#ff5252","#4fc3f7","#81c784","#ffd54f","#ce93d8"];
    return c[Math.floor(Math.random()*c.length)];
}
function hit(a,b){
    return a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;
}

/* ===== GAME STATE ===== */
let player, enemy, bullets, roadY;
let score, level, finished;

/* ===== RESET CEPAT ===== */
function resetGame(){
    player={
        x:160,y:380,w:44,h:80,
        vx:0,vy:0,
        accel:0.5,max:5,friction:0.85,
        color:"#ff5252"
    };
    enemy={
        x:160,y:-90,w:44,h:80,
        speed:3,color:randColor()
    };
    bullets=[];
    roadY=0;
    score=0;
    level=1;
    finished=false;
}

/* ===== SHOOT ===== */
function shoot(){
    if(finished) return;
    bullets.push({
        x:player.x+player.w/2-3,
        y:player.y,
        w:6,h:12,
        speed:7
    });
}

/* ===== DRAW ROAD ===== */
function drawRoad(){
    ctx.fillStyle="#2e7d32";
    ctx.fillRect(0,0,60,500);
    ctx.fillRect(300,0,60,500);

    ctx.fillStyle="#555";
    ctx.fillRect(60,0,240,500);

    ctx.strokeStyle="white";
    ctx.setLineDash([20,20]);
    ctx.lineWidth=4;
    ctx.beginPath();
    ctx.moveTo(180,-roadY);
    ctx.lineTo(180,500);
    ctx.stroke();
    ctx.setLineDash([]);

    roadY+=enemy.speed;
    if(roadY>40) roadY=0;
}

/* ===== DRAW CAR ===== */
function drawCar(o){
    // BODY MOBIL
    ctx.beginPath();
    ctx.moveTo(o.x + 8, o.y);
    ctx.lineTo(o.x + o.w - 8, o.y);
    ctx.quadraticCurveTo(o.x + o.w, o.y + 6, o.x + o.w, o.y + 22);
    ctx.lineTo(o.x + o.w, o.y + o.h - 22);
    ctx.quadraticCurveTo(o.x + o.w, o.y + o.h, o.x + o.w - 8, o.y + o.h);
    ctx.lineTo(o.x + 8, o.y + o.h);
    ctx.quadraticCurveTo(o.x, o.y + o.h, o.x, o.y + o.h - 22);
    ctx.lineTo(o.x, o.y + 22);
    ctx.quadraticCurveTo(o.x, o.y + 6, o.x + 8, o.y);
    ctx.closePath();

    const bodyGrad = ctx.createLinearGradient(o.x, o.y, o.x, o.y + o.h);
    bodyGrad.addColorStop(0, "#ffffff");
    bodyGrad.addColorStop(0.35, o.color);
    bodyGrad.addColorStop(1, "#222");
    ctx.fillStyle = bodyGrad;
    ctx.fill();

    // KACA DEPAN
    ctx.fillStyle = "#b3e5fc";
    ctx.fillRect(o.x + 10, o.y + 10, o.w - 20, 18);

    // KACA BELAKANG
    ctx.fillRect(o.x + 12, o.y + o.h - 32, o.w - 24, 14);

    // LAMPU DEPAN
    ctx.fillStyle = "yellow";
    ctx.fillRect(o.x + 6, o.y + 4, 6, 6);
    ctx.fillRect(o.x + o.w - 12, o.y + 4, 6, 6);

    // RODA KIRI
    ctx.fillStyle = "#000";
    ctx.fillRect(o.x - 4, o.y + 18, 4, 16);
    ctx.fillRect(o.x - 4, o.y + o.h - 34, 4, 16);

    // RODA KANAN
    ctx.fillRect(o.x + o.w, o.y + 18, 4, 16);
    ctx.fillRect(o.x + o.w, o.y + o.h - 34, 4, 16);
}


/* ===== UI ===== */
function drawUI(){
    ctx.fillStyle="white";
    ctx.font="16px Arial";
    ctx.fillText("Score: "+score,10,22);
    ctx.fillText("Level: "+level+"/5",260,22);
}

/* ===== FINISH ===== */
function drawFinish(){
    ctx.fillStyle="rgba(0,0,0,0.8)";
    ctx.fillRect(0,0,360,500);
    ctx.fillStyle="lime";
    ctx.font="32px Arial";
    ctx.fillText("YOU WIN!",90,240);
    ctx.font="18px Arial";
    ctx.fillText("Press R to Restart",95,280);
}

/* ===== GAME LOOP ===== */
function loop(){
    ctx.clearRect(0,0,360,500);

    if(finished){
        drawRoad();
        drawFinish();
        return requestAnimationFrame(loop);
    }

    // movement (smooth)
    if(keys.left) player.vx -= player.accel;
    if(keys.right) player.vx += player.accel;
    if(keys.up) player.vy -= player.accel;
    if(keys.down) player.vy += player.accel;

    player.vx *= player.friction;
    player.vy *= player.friction;

    player.vx = Math.max(-player.max, Math.min(player.max, player.vx));
    player.vy = Math.max(-player.max, Math.min(player.max, player.vy));

    player.x += player.vx;
    player.y += player.vy;

    // batas
    if(player.x<60){player.x=60;player.vx=0;}
    if(player.x>260){player.x=260;player.vx=0;}
    if(player.y<0){player.y=0;player.vy=0;}
    if(player.y>420){player.y=420;player.vy=0;}

    drawRoad();
    drawCar(player);
    drawCar(enemy);
    drawUI();

    // bullets
    bullets.forEach(b=>b.y-=b.speed);
    bullets=bullets.filter(b=>b.y>-20);
    ctx.fillStyle="yellow";
    bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));

    // enemy
    enemy.y+=enemy.speed;
    if(enemy.y>500){
        enemy.y=-90;
        enemy.x=60+Math.random()*200;
        enemy.color=randColor();
    }

    // hit enemy
    bullets.forEach((b,i)=>{
        if(hit(b,enemy)){
            bullets.splice(i,1);
            enemy.y=-90;
            enemy.x=60+Math.random()*200;
            enemy.color=randColor();
            score++;

            if(score % 5 === 0){
                level++;
                enemy.speed += 0.5;
            }
            if(level > 5){
                finished=true;
            }
        }
    });

    requestAnimationFrame(loop);
}

/* ===== START ===== */
resetGame();
loop();
</script>

</body>
</html>
